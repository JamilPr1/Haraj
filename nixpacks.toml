[phases.setup]
nixPkgs = ["python39", "chromium", "chromedriver", "libnss3", "libatk-bridge2.0-0", "libx11-xcb1", "libgbm1"]

[phases.install]
cmds = [
  "apt-get update && apt-get install -y wget gnupg unzip curl || true",
  "wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - || true",
  "echo 'deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main' >> /etc/apt/sources.list.d/google-chrome.list || true",
  "apt-get update && apt-get install -y google-chrome-stable libnss3 libatk-bridge2.0-0 libx11-xcb1 libgbm1 || echo 'Chrome installation failed, will use webdriver-manager'"
]

[phases.build]
cmds = []

[start]
cmd = "gunicorn dashboard:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120"
